<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dot Shader Background</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #121212;
    height: 100%;
    width: 100%;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script id="vertexShader" type="x-shader/x-vertex">
  varying vec2 vUv;
  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
  }
</script>

<script id="fragmentShader" type="x-shader/x-fragment">
  uniform float time;
  uniform vec2 resolution;
  uniform vec3 dotColor;
  uniform vec3 bgColor;
  uniform sampler2D mouseTrail;
  uniform float gridSize;
  uniform float dotOpacity;
  varying vec2 vUv;

  vec2 rotate(vec2 uv, float angle){
      float s = sin(angle);
      float c = cos(angle);
      mat2 m = mat2(c,-s,s,c);
      return m*(uv-0.5)+0.5;
  }

  float sdfCircle(vec2 p,float r){
      return length(p-0.5)-r;
  }

  void main(){
      vec2 uv = vUv;
      vec2 rotatedUv = rotate(uv, 0.0);

      vec2 gridUv = fract(rotatedUv*gridSize);
      vec2 cellCenter = (floor(rotatedUv*gridSize)+0.5)/gridSize;
      float mouseInfluence = texture2D(mouseTrail, cellCenter).r;

      float dot = smoothstep(0.05, 0.0, sdfCircle(gridUv,0.25 + mouseInfluence*0.5));
      vec3 color = mix(bgColor,dotColor,dot*dotOpacity);
      gl_FragColor = vec4(color,1.0);
  }
</script>

<script>
  let scene, camera, renderer, material, mesh;
  let mouseTrailTex, trailData;
  const gridSize = 50;
  const width = window.innerWidth;
  const height = window.innerHeight;

  init();
  animate();

  function init(){
      scene = new THREE.Scene();
      camera = new THREE.OrthographicCamera(-1,1,1,-1,0,1);
      renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(window.innerWidth,window.innerHeight);
      document.body.appendChild(renderer.domElement);

      trailData = new Uint8Array(512*512*4);
      for(let i=0;i<trailData.length;i++) trailData[i] = 0;
      const trailTexture = new THREE.DataTexture(trailData,512,512,THREE.RGBAFormat);
      trailTexture.needsUpdate = true;
      mouseTrailTex = trailTexture;

      material = new THREE.ShaderMaterial({
          uniforms:{
              time:{value:0},
              resolution:{value:new THREE.Vector2(width,height)},
              dotColor:{value:new THREE.Color('#ffffff')},
              bgColor:{value:new THREE.Color('#121212')},
              mouseTrail:{value:mouseTrailTex},
              gridSize:{value:gridSize},
              dotOpacity:{value:0.05}
          },
          vertexShader: document.getElementById('vertexShader').textContent,
          fragmentShader: document.getElementById('fragmentShader').textContent
      });

      const geometry = new THREE.PlaneGeometry(2,2);
      mesh = new THREE.Mesh(geometry,material);
      scene.add(mesh);

      window.addEventListener('mousemove',onMouseMove,false);
      window.addEventListener('resize',onWindowResize,false);
  }

  function onWindowResize(){
      material.uniforms.resolution.value.set(window.innerWidth,window.innerHeight);
      renderer.setSize(window.innerWidth,window.innerHeight);
  }

  function onMouseMove(e){
      const x = Math.floor((e.clientX/window.innerWidth)*512);
      const y = Math.floor((1-e.clientY/window.innerHeight)*512);
      const index = (y*512+x)*4;
      trailData[index] = 255;
      mouseTrailTex.needsUpdate = true;
  }

  function animate(){
      requestAnimationFrame(animate);
      material.uniforms.time.value = performance.now()*0.001;

      // Fade the mouse trail
      for(let i=0;i<trailData.length;i++){
          trailData[i] = Math.max(0, trailData[i]-2);
      }
      mouseTrailTex.needsUpdate = true;

      renderer.render(scene,camera);
  }
</script>
</body>
</html>
